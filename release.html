<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">


    <title>AniLibria iPad</title>
    <meta property="og:site_name" content="AniLibria iPad">
    <meta property="og:type" content="Website">
    <meta property="og:title" content="AniLibria - так звучит аниме!">
    <meta property="og:description" content="Смотреть аниме онлайн в любимой озучке.">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <link rel="icon" id="appIcon" type="image/png" href="Logo.png">
    <link rel="stylesheet" type="text/css" href="theme2.css" />
    <link rel="stylesheet" type="text/css" href="main.css" />
    <link rel="manifest" href="manifest.json">
    <!-- <link rel="manifest" href="manifest.webmanifest"> -->
    <script type="text/javascript" src="playerjs.js" ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>
    <script type="text/javascript" src="theme.js" ></script>

    <!-- iOS web app configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AniLibria iPad">

    <!-- iOS web app icons -->
    <link rel="apple-touch-icon" href="Logo-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="Logo-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="Logo-167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="Logo-180.png">
    <!-- iOS splash screens -->
    <!-- iPad -->
    <link rel="apple-touch-startup-image" href="Logo.png">

  </head>
  <body ontouchstart="">
    <header>
      <div class="block_header">
        <a href="index.html">Главная</a>
        <a href="catalog.html">Каталог</a>
        <a href="favorites.html">Избранное</a>
        <form class="block_search" method="get" action="search.html">
          <input type="text" name="q" class="search_box" placeholder="Поиск релиза..." required="" style="width: 130px;height: 26px;">
          <button type="submit" class="search_button">Найти</button>
        </form>
        <button type="submit" class="theme" id="b_theme1" onclick="theme1()" style="display: none;">День</button>
        <button type="submit" class="theme" id="b_theme2" onclick="theme2()">Ночь</button>
      </div>
    </header>


<center>
    <div class="release-block block_header_small">
      <div id="release_block"></div>
          <script type="text/javascript">
            var url_relise = '';
            var paramsString = document.location.search;
            var searchParams = new URLSearchParams(paramsString);
            searchParams.get("id");
            if (!searchParams.get("id") && searchParams.get("random") == '1') {
              url = 'https://api.anilibria.tv/v2/getRandomTitle?filter=id,season,type,names,poster,genres,description,playlist,player,in_favorites';
            } else if (searchParams.get("id")) {
              url = 'https://api.anilibria.tv/v2/getTitle?id='+searchParams.get("id")+'&filter=id,season,type,names,poster,genres,description,playlist,player,in_favorites';
            } else {
                document.getElementById('release_block').setAttribute("style", "display:none;");
            }
            fetch(url)
            .then(function (response) {
              if (response.status !== 200) {
                return Promise.reject(new Error(response.statusText))
              }
              return Promise.resolve(response)
            })
            .then(function (response) {
              return response.json()
            })
            .then(function (data) {
              var url = document.location;
              var paramsString = document.location.search;
              var searchParams = new URLSearchParams(paramsString);
              if (!searchParams.get("id") && searchParams.get("random") == '1') {
                window.location.search = "id="+data["id"]+"";
              }
              var genres = '';
              var div = document.createElement('div');
              document.getElementById('release_block').appendChild(div);
              div.className = 'release-list';
              div.setAttribute("style", "");
              if (data["genres"][5] != undefined) {
                genres = data["genres"][0]+' | '+ data["genres"][1]+' | '+ data["genres"][2]+' | '+ data["genres"][3]+' | '+ data["genres"][4]+' | '+ data["genres"][5];
              } else if(data["genres"][4] != undefined) {
                genres = data["genres"][0]+' | '+ data["genres"][1]+' | '+ data["genres"][2]+' | '+ data["genres"][3]+' | '+ data["genres"][4];
              } else if(data["genres"][3] != undefined) {
                genres = data["genres"][0]+' | '+ data["genres"][1]+' | '+ data["genres"][2]+' | '+ data["genres"][3];
              } else if(data["genres"][2] != undefined) {
                  genres = data["genres"][0]+' | '+ data["genres"][1]+' | '+ data["genres"][2];
              } else if(data["genres"][1] != undefined) {
                genres = data["genres"][0]+' | '+ data["genres"][1];
              } else {
                genres = data["genres"][0];
              }
              div.innerHTML = '<div class="release-list"> <img src="https://www.anilibria.tv'+data["poster"]["url"]+'" /> <div class="release-det"> <p class="release-name">'+data["names"]["ru"]+'</p> <p class="release-description">'+genres+'</p> <p class="release-description"> <a class="release-href release-href_hov" href="season.html?year='+data["season"]["year"]+'&code='+data["season"]["code"]+'">'+data["season"]["year"]+' '+data["season"]["string"]+'</a> <a class="release-href" target="_self">'+data["type"]["full_string"]+'</a> </p> <form method="post" style="display: contents;"> <button type="submit" class="favor_button" name="delFavorite" value="День">В избранном</button> </form> <p class="release-description" style="padding: 10px 0;"> <a class="release-href" style="background:var(--card-text-color-3); color:var(--card-background-2)!important;">Смотрят '+data["in_favorites"]+'</a> </p> <p class="release-description">'+data["description"]+'</p> </div> </div>';
            })
            .catch(function (error) {
              console.log('error', error)
            })
          </script>

          <br />

          <div id="serie_href" style="max-width: 730px;"></div>
          <script type="text/javascript">
            var paramsString = document.location.search;
            var searchParams = new URLSearchParams(paramsString);
            fetch('https://api.anilibria.tv/v2/getTitle?id='+searchParams.get("id")+'&filter=id,player')
            .then(function (response) {
              if (response.status !== 200) {
                return Promise.reject(new Error(response.statusText))
              }
              return Promise.resolve(response)
            })
            .then(function (response) {
              return response.json()
            })
            .then(function (data) {
              // var url_relise = data["player"]["host"]+data["player"]["playlist"][1]["hls"]["hd"];
              var data2=data["player"]["series"]["last"];
              for (let i = 0; i < data2; i++) {
                // url_relise = ''+data["player"]["host"];
                // console.log(data3[i]["hls"]);
                var i2 = i+1;
                var div = document.createElement('div');
                document.getElementById('serie_href').appendChild(div);
                div.setAttribute("style", "display: contents;");
                div.innerHTML = '<a href="https://'+data["player"]["host"]+data["player"]["playlist"][i2]["hls"]["hd"]+'" class="release-href release-href_hov" style="margin: 5px !important;width: 33px;">'+ i2 +'</a>';

              }
            })

            .catch(function (error) {
              console.log('error', error)
            })

          </script><br /><br />
    </div>
</center>

<br /><br /><br /><br />
<script type="text/javascript" src="script.js" ></script>
<div id="preloader"><div id="preloader_preload"></div></div>
</body>
</html>
