<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>LiteLibria</title>
    <meta property="og:site_name" content="AniLibria iPad">
    <meta property="og:type" content="Website">
    <meta property="og:title" content="AniLibria - так звучит аниме!">
    <meta property="og:description" content="Смотреть аниме онлайн в любимой озучке.">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <link rel="icon" id="appIcon" type="image/png" href="img/Logo.png">
    <link rel="stylesheet" type="text/css" href="css/auto.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="manifest" href="manifest/manifest.json">
    <script type="text/javascript" src="js/playerjs.js" ></script>
    <script src="js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/theme.js" ></script>
    <script type="text/javascript" src="js/script.js" ></script>
    <script src="https://use.fontawesome.com/b559c64803.js"></script>

    <!-- iOS web app configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AniLibria lite">

    <!-- WEB web app icons -->
    <link rel="icon" href="../img/icon/web/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="../img/icon/web/apple-touch-icon.png">
    <!-- WEB splash screens -->
    <!-- iPad -->
    <link rel="apple-touch-startup-image" href="../img/icon/web/apple-touch-icon.png">
  </head>
  <body ontouchstart="">
    <div id="block_notif"></div>
    <div id="preloader"><div id="preloader_preload" onclick="preloader_none();"></div><p id="preloader_preload_but"><span id="loader_text">Идёт загрузка...</span><span id="loader1"></span><span id="loader2"></span></p></div>
    <a class="back_to_top" title="Наверх">↑</a>
    <header>
      <div class="block_header">
        <a href="index">Главная</a>
        <a href="catalog">Каталог</a>
        <a href="favorites" style="color: var(--card-text-color-2);background: var(--card-background-3);">Избранное</a>
        <form class="block_search" method="get" action="search">
          <input type="text" name="q" class="search_box" placeholder="Поиск релиза...">
          <button type="submit" class="search_button"><i class="fa fa-search" aria-hidden="true"></i></button>
          <a type="submit" class="theme" id="b_theme1" onclick="theme1()" style="display: none;"><img src="img/sun.png" alt=""style="width: 20px;"></a>
          <a type="submit" class="theme" id="b_theme2" onclick="theme2()" style="display: none;"><img src="img/moon.png" alt="" style="width: 20px;"></a>
          <a type="submit" class="theme" id="b_auto" onclick="theme_auto()"><img src="img/auto.png" alt="" style="width: 20px;"></a>
        </form>
      </div>
    </header>
    <div class="article-block" id="sorting_block_none">
      <center>
        <div class="article-list block_header_small block_chosen">
            <!-- <a class="pages_catalog" href="" style="cursor:pointer;">⇅</a> -->
            <div class="select_form">
              <select id="sorting_block" class="chosen_box chosen_box2">
                <option value="0">Сортировать по ...</option>
                <option value="year">Году</option>
                <option value="codes">Названию</option>
                <option value="in_favorites">Популярности</option>
                <option value="series">Количеству серий</option>
                <option value="code">Типу</option>
              </select>
              <label class="container">
                <input type="checkbox" checked="checked" id="checkbox_sorting">
                <span class="checkmark"></span>
              </label>
              <button class="chosen_button" onclick="load_sortingTitles_Favorites();">Показать</button>
            </div>
        </div>
      </center>
    </div>
    <div class="article-block">
      <center>
        <div class="article-list block_header_small">
          <h1 style="font-weight: 500;text-align: left;color: var(--card-text-color);padding: 0px 0px 10px 10px;font-size: 24px;">Избранные тайтлы</h1>
          <div id="error" style="display:none;">
            <h1 style="color: var(--card-text-color);">Ничего не найдено!</h1>
            <br>
            <img src="img/libriatyan/1.png" style="max-width: 90%;">
          </div>
          <div id="relise_block"></div>

          <form class="login_block" id="form_login" style="display: none;">
            <p>Вы не авторизованы</p>
            <a class="release-href release-href_hov" href="settings" style="margin-top: 20px;">Авторизоваться</a>
          </form>
        </div>
      </center>
    </div>
    <br /><br /><br /><br />

  <script>
    var cookie = localStorage.getItem('PHPSESSID');
    if (!cookie || cookie == 'undefined') {
      // document.getElementById('form_logout').setAttribute("style", "display:none;");
      document.getElementById('relise_block').setAttribute("style", "display:none;");
      document.getElementById('form_login').setAttribute("style", "");
      document.getElementById('sorting_block_none').setAttribute("style", "display:none;");
      preloader_none();
    } else {
      // document.getElementById('form_logout').setAttribute("style", "");
      document.getElementById('relise_block').setAttribute("style", "");
      document.getElementById('form_login').setAttribute("style", "display:none;");
      document.getElementById('sorting_block_none').setAttribute("style", "");
      loadFavorites(cookie);
    }

    function load_sortingTitles_Favorites() {
      var my_home_style = localStorage.getItem('my_home_style');
      if (!my_home_style || my_home_style == '1') {
        // Удаляем все тайтлы со страницы
        var container_favorites = document.getElementById("relise_block");
        var elements_favorites = container_favorites.getElementsByClassName("article");
        while (elements_favorites[0]) {
            elements_favorites[0].parentNode.removeChild(elements_favorites[0]);
        }
        var cookie = localStorage.getItem('PHPSESSID');
        loadFavorites(cookie); // Открываем страницу с отсортированным результатом для нужной страницы
      } else if (my_home_style == '2'){
        var container_favorites = document.getElementById("relise_block");
        var elements_favorites = container_favorites.getElementsByClassName("article_design_2");
        while (elements_favorites[0]) {
            elements_favorites[0].parentNode.removeChild(elements_favorites[0]);
        }
        var cookie = localStorage.getItem('PHPSESSID');
        loadFavorites(cookie); // Открываем страницу с отсортированным результатом для нужной страницы
      }
    }


    function loadFavorites(cookie) {
      document.getElementById('sorting_block_none').setAttribute("style", "");
      document.getElementById('form_login').setAttribute("style", "display:none;");

      var url = "https://api.anilibria.tv/v2/getFavorites?session="+cookie+"?filter=id&limit=-1";

      // Получаем из кэша браузера все тайтлы
      arr_api = JSON.parse(localStorage.getItem('my_api_cash'));

      if (arr_api) {
        array_creation();
      } else {
        setTimeout(function() {
          array_creation();
        }, 10000);
      }
      function array_creation() {
        var n,
            arr_filter_genres,
            arr_api,
            genres;

        // Получаем из кэша браузера все тайтлы
        arr_api = JSON.parse(localStorage.getItem('my_api_cash'));

        // Получаем из кэша браузера жанры которые нельзя отображать
        var cookie_genres = localStorage.getItem('my_genres');
        if (cookie_genres) {
          genres = cookie_genres.split(/\s*,\s*/);
        } else {
          localStorage.setItem('my_genres', '');
          cookie_genres = localStorage.getItem('my_genres');
          genres = cookie_genres.split(/\s*,\s*/);
        }

        // Удаляем из результата жанры которые нельзя отображать
        arr = arr_api.filter(function(item) {
        for (var key in genres) {
            if (item.genres.includes(genres[key]))
              return false;
          }
          return true;
        });

        // Получаем значения посе фильтров и поисков
        var sorting = document.getElementById("sorting_block").value;

        // Получаем значения из блока сортировки
        var checkbox_sorting = '1';
        if (document.querySelector('#checkbox_sorting:checked')) {
           checkbox_sorting = '0';
        }
        if (sorting == '0') {
          if (checkbox_sorting == '1'){arr;}else{arr;}
        } else if(sorting == 'year'){
          if (checkbox_sorting == '1'){arr.sort((a, b) => (a.season['year'] > b.season['year']) ? 1 : -1);}else {arr.sort((a, b) => (a.season['year'] < b.season['year']) ? 1 : -1);}
        } else if(sorting == 'codes'){
          if (checkbox_sorting == '1'){arr.sort((a, b) => (a.code > b.code) ? 1 : -1);}else{arr.sort((a, b) => (a.code < b.code) ? 1 : -1);}
        } else if(sorting == 'in_favorites'){
          if (checkbox_sorting == '1'){arr.sort((a, b) => (a.in_favorites > b.in_favorites) ? 1 : -1);}else{arr.sort((a, b) => (a.in_favorites < b.in_favorites) ? 1 : -1);}
        } else if(sorting == 'series'){
          if (checkbox_sorting == '1'){arr.sort((a, b) => (a.type['series'] > b.type['series']) ? 1 : -1);}else{arr.sort((a, b) => (a.type['series'] < b.type['series']) ? 1 : -1);}
        } else if(sorting == 'code'){
          if (checkbox_sorting == '1'){arr.sort((a, b) => (a.type['code'] > b.type['code']) ? 1 : -1);}else{arr.sort((a, b) => (a.type['code'] < b.type['code']) ? 1 : -1);}
        } else{
          if (checkbox_sorting == '1'){arr;}else{arr;}
        }
        article_favorites(url, 'relise_block', arr);
      }
    }
    Scroll_to_top();
  </script>

  <a href="https://rozenrod.ml" style="font-size: 15px;font-weight: 300;text-decoration: none;background: var(--card-background-2);padding: 5px 10px;color: var(--card-text-color);float: right;margin-bottom: 20px;margin-right: 15px;border-radius: var(--border-radius);">Rozenrod 2022</a><br />
</body>
</html>
